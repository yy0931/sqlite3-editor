"use strict";var y=Object.create;var c=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var v=(e,r)=>{for(var o in r)c(e,o,{get:r[o],enumerable:!0})},p=(e,r,o,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of f(r))!g.call(e,t)&&t!==o&&c(e,t,{get:()=>r[t],enumerable:!(n=w(r,t))||n.enumerable});return e};var m=(e,r,o)=>(o=e!=null?y(b(e)):{},p(r||!e||!e.__esModule?c(o,"default",{value:e,enumerable:!0}):o,e)),h=e=>p(c({},"__esModule",{value:!0}),e);var q={};v(q,{activate:()=>E,deactivate:()=>U});module.exports=h(q);var a=m(require("vscode")),d=m(require("sqlite3")),l=require("msgpackr");const C=(e,r,o)=>new Promise((n,t)=>{const s=(0,l.unpack)(e.body);if(typeof s.query!="string"){t(new Error(`Invalid search params: ${JSON.stringify(s)}`));return}if(!(Array.isArray(s.params)&&s.params.every(i=>i===null||typeof i=="number"||typeof i=="string"||i instanceof Buffer))){t(new Error(`Invalid search params: ${JSON.stringify(s)}`));return}if(!["r","w+"].includes(s.mode)){t(new Error(`Invalid search params: ${JSON.stringify(s)}`));return}(s.mode==="w+"?o:r).all(s.query,s.params,(i,u)=>{if(i!==null){t(new Error(`${i.message}
Query: ${s.query}
Params: ${JSON.stringify(s.params)}`));return}n(new Uint8Array((0,l.pack)(u)))})}),E=e=>{e.subscriptions.push(a.default.window.registerCustomEditorProvider("sqlite3-editor.editor",{openCustomDocument(r,o,n){const t=new d.default.Database(r.fsPath,d.default.OPEN_READONLY),s=new d.default.Database(r.fsPath);return{uri:r,dispose:()=>{t.close(),s.close()},readonlyConnection:t,readWriteConnection:s}},async resolveCustomEditor(r,o,n){o.webview.options={enableScripts:!0,localResourceRoots:[a.default.Uri.joinPath(e.extensionUri,"webview")]},o.webview.html=(await a.default.workspace.fs.readFile(a.default.Uri.joinPath(e.extensionUri,"webview","index.html"))).toString().replace(/((?:src|href)=")\/([^"]+)(")/g,(t,s,i,u)=>s+o.webview.asWebviewUri(a.default.Uri.joinPath(e.extensionUri,"webview",i)).toString()+u),e.subscriptions.push(o.webview.onDidReceiveMessage(({requestId:t,body:s})=>{C({body:s},r.readonlyConnection,r.readWriteConnection).then(i=>o.webview.postMessage({requestId:t,body:i})).catch(i=>{console.log("catch!!!!!"),console.log("sent: "+JSON.stringify({requestId:t,err:i.message})),o.webview.postMessage({requestId:t,err:i.message})})}))}},{supportsMultipleEditorsPerDocument:!1,webviewOptions:{enableFindWidget:!0,retainContextWhenHidden:!0}}))},U=()=>{};0&&(module.exports={activate,deactivate});
